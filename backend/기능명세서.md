# 커뮤니티 서비스 기능명세서

## 문서 정보
| 항목 | 내용 |
|-----|------|
| 버전 | v1.0 |
| 작성일 | 2025-11-25 |
| 기반 문서 | DATABASE_v2.md (45개 테이블) |

---

## 목차
1. [회원](#1-회원)
2. [게시판](#2-게시판)
3. [게시글](#3-게시글)
4. [댓글](#4-댓글)
5. [상호작용](#5-상호작용)
6. [검색](#6-검색)
7. [포인트/상점](#7-포인트상점)
8. [관리자](#8-관리자)
9. [기타](#9-기타)

---

## 1. 회원

### 1.1 회원가입
| 항목 | 내용 |
|-----|------|
| 기능 ID | USER-001 |
| 설명 | 신규 사용자 회원가입 |
| 선행조건 | 없음 |
| 입력값 | login_id, password, email, display_name |
| 처리로직 | 1. login_id 중복 검사<br>2. email 중복 검사<br>3. 비밀번호 BCrypt 해시<br>4. users 테이블 INSERT (status=ACTIVE, is_email_verified=N)<br>5. user_settings 기본값 INSERT<br>6. user_points 초기화 (0포인트)<br>7. 이메일 인증 메일 발송 (message_queue INSERT) |
| 결과 | 회원 생성, 인증 메일 발송 |
| 관련 테이블 | users, user_settings, user_points, message_queue |

### 1.2 로그인
| 항목 | 내용 |
|-----|------|
| 기능 ID | USER-002 |
| 설명 | 사용자 로그인 및 토큰 발급 |
| 선행조건 | 회원가입 완료 |
| 입력값 | login_id, password |
| 처리로직 | 1. login_id로 사용자 조회<br>2. 비밀번호 검증<br>3. 계정 상태 확인 (SUSPENDED/DELETED 체크)<br>4. login_histories INSERT<br>5. Access Token + Refresh Token 발급<br>6. refresh_tokens INSERT (token_hash 저장)<br>7. users.last_login_at UPDATE |
| 결과 | JWT 토큰 발급 |
| 관련 테이블 | users, login_histories, refresh_tokens |

### 1.3 로그아웃
| 항목 | 내용 |
|-----|------|
| 기능 ID | USER-003 |
| 설명 | 사용자 로그아웃 |
| 선행조건 | 로그인 상태 |
| 입력값 | refresh_token |
| 처리로직 | 1. refresh_tokens에서 해당 토큰 is_revoked = Y 처리 |
| 결과 | 토큰 무효화 |
| 관련 테이블 | refresh_tokens |

### 1.4 토큰 갱신
| 항목 | 내용 |
|-----|------|
| 기능 ID | USER-004 |
| 설명 | Refresh Token으로 Access Token 재발급 |
| 선행조건 | 유효한 Refresh Token 보유 |
| 입력값 | refresh_token |
| 처리로직 | 1. token_hash로 refresh_tokens 조회<br>2. 만료/폐기 여부 확인<br>3. 새 Access Token 발급<br>4. (선택) Refresh Token Rotation |
| 결과 | 새 Access Token 발급 |
| 관련 테이블 | refresh_tokens |

### 1.5 이메일 인증
| 항목 | 내용 |
|-----|------|
| 기능 ID | USER-005 |
| 설명 | 이메일 인증 완료 처리 |
| 선행조건 | 회원가입 완료, 인증 메일 수신 |
| 입력값 | 인증 토큰 (URL 파라미터) |
| 처리로직 | 1. 인증 토큰 유효성 검증<br>2. users.is_email_verified = Y UPDATE |
| 결과 | 이메일 인증 완료 |
| 관련 테이블 | users |

### 1.6 비밀번호 변경
| 항목 | 내용 |
|-----|------|
| 기능 ID | USER-006 |
| 설명 | 로그인 상태에서 비밀번호 변경 |
| 선행조건 | 로그인 상태 |
| 입력값 | current_password, new_password |
| 처리로직 | 1. 현재 비밀번호 검증<br>2. password_histories에서 최근 N개와 비교 (재사용 방지)<br>3. 새 비밀번호 BCrypt 해시<br>4. users.password UPDATE<br>5. password_histories INSERT<br>6. 모든 refresh_tokens 폐기 (선택) |
| 결과 | 비밀번호 변경 완료 |
| 관련 테이블 | users, password_histories, refresh_tokens |

### 1.7 비밀번호 찾기
| 항목 | 내용 |
|-----|------|
| 기능 ID | USER-007 |
| 설명 | 비밀번호 재설정 메일 발송 |
| 선행조건 | 없음 |
| 입력값 | email |
| 처리로직 | 1. email로 사용자 조회<br>2. 재설정 토큰 생성<br>3. message_queue INSERT (재설정 링크 메일) |
| 결과 | 재설정 메일 발송 |
| 관련 테이블 | users, message_queue |

### 1.8 비밀번호 재설정
| 항목 | 내용 |
|-----|------|
| 기능 ID | USER-008 |
| 설명 | 토큰으로 비밀번호 재설정 |
| 선행조건 | 재설정 메일 수신 |
| 입력값 | reset_token, new_password |
| 처리로직 | 1. 토큰 유효성 검증<br>2. password_histories 재사용 검사<br>3. users.password UPDATE<br>4. password_histories INSERT<br>5. 모든 refresh_tokens 폐기 |
| 결과 | 비밀번호 재설정 완료 |
| 관련 테이블 | users, password_histories, refresh_tokens |

### 1.9 프로필 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | USER-009 |
| 설명 | 사용자 프로필 정보 조회 |
| 선행조건 | 없음 (공개 정보) |
| 입력값 | user_id 또는 login_id |
| 처리로직 | 1. users 조회 (공개 필드만)<br>2. 게시글/댓글 수 집계 (선택) |
| 결과 | 프로필 정보 반환 |
| 관련 테이블 | users, posts, comments |

### 1.10 프로필 수정
| 항목 | 내용 |
|-----|------|
| 기능 ID | USER-010 |
| 설명 | 내 프로필 정보 수정 |
| 선행조건 | 로그인 상태 |
| 입력값 | display_name, profile_image_url |
| 처리로직 | 1. display_name 변경 시 display_name_histories INSERT<br>2. users UPDATE |
| 결과 | 프로필 수정 완료 |
| 관련 테이블 | users, display_name_histories |

### 1.11 회원 탈퇴
| 항목 | 내용 |
|-----|------|
| 기능 ID | USER-011 |
| 설명 | 회원 탈퇴 처리 |
| 선행조건 | 로그인 상태 |
| 입력값 | password (확인용) |
| 처리로직 | 1. 비밀번호 확인<br>2. users.status = DELETED, deleted_at = NOW() UPDATE<br>3. 모든 refresh_tokens 폐기<br>4. 개인정보 마스킹 (선택) |
| 결과 | 탈퇴 처리 완료 |
| 관련 테이블 | users, refresh_tokens |

### 1.12 설정 조회/수정
| 항목 | 내용 |
|-----|------|
| 기능 ID | USER-012 |
| 설명 | 사용자 설정 조회 및 수정 |
| 선행조건 | 로그인 상태 |
| 입력값 | theme, language, timezone, hide_nsfw |
| 처리로직 | 1. user_settings 조회/UPDATE |
| 결과 | 설정 정보 반환/수정 완료 |
| 관련 테이블 | user_settings |

### 1.13 알림 설정 조회/수정
| 항목 | 내용 |
|-----|------|
| 기능 ID | USER-013 |
| 설명 | 알림 수신 설정 관리 |
| 선행조건 | 로그인 상태 |
| 입력값 | notification_type, is_enabled |
| 처리로직 | 1. user_notification_settings 조회/UPSERT |
| 결과 | 알림 설정 반환/수정 완료 |
| 관련 테이블 | user_notification_settings |

### 1.14 사용자 차단
| 항목 | 내용 |
|-----|------|
| 기능 ID | USER-014 |
| 설명 | 특정 사용자 차단 |
| 선행조건 | 로그인 상태 |
| 입력값 | target_user_id |
| 처리로직 | 1. 자기 자신 차단 불가 검증<br>2. user_blocks INSERT |
| 결과 | 차단 완료 (해당 사용자 콘텐츠 숨김) |
| 관련 테이블 | user_blocks |

### 1.15 사용자 차단 해제
| 항목 | 내용 |
|-----|------|
| 기능 ID | USER-015 |
| 설명 | 차단한 사용자 차단 해제 |
| 선행조건 | 로그인 상태, 차단 상태 |
| 입력값 | target_user_id |
| 처리로직 | 1. user_blocks DELETE |
| 결과 | 차단 해제 완료 |
| 관련 테이블 | user_blocks |

### 1.16 차단 목록 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | USER-016 |
| 설명 | 내가 차단한 사용자 목록 조회 |
| 선행조건 | 로그인 상태 |
| 입력값 | page, size |
| 처리로직 | 1. user_blocks 조회 (user_id 기준) |
| 결과 | 차단 목록 반환 |
| 관련 테이블 | user_blocks, users |

---

## 2. 게시판

### 2.1 게시판 목록 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | BOARD-001 |
| 설명 | 전체 게시판 목록 조회 |
| 선행조건 | 없음 |
| 입력값 | 없음 |
| 처리로직 | 1. boards 조회 (is_active = Y, sort_order 정렬) |
| 결과 | 게시판 목록 반환 |
| 관련 테이블 | boards |

### 2.2 게시판 상세 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | BOARD-002 |
| 설명 | 특정 게시판 상세 정보 조회 |
| 선행조건 | 없음 |
| 입력값 | board_id |
| 처리로직 | 1. boards 조회<br>2. board_categories 조회<br>3. 구독자 수 집계 (선택) |
| 결과 | 게시판 상세 정보 반환 |
| 관련 테이블 | boards, board_categories, board_subscriptions |

### 2.3 게시판 생성
| 항목 | 내용 |
|-----|------|
| 기능 ID | BOARD-003 |
| 설명 | 새 게시판 생성 |
| 선행조건 | 로그인 상태 |
| 입력값 | board_name, description, icon_url, banner_url, allow_nsfw |
| 처리로직 | 1. board_name 중복 검사<br>2. boards INSERT (creator_id = 현재 사용자)<br>3. board_subscriptions INSERT (생성자를 MODERATOR로) |
| 결과 | 게시판 생성 완료 |
| 관련 테이블 | boards, board_subscriptions |

### 2.4 게시판 수정
| 항목 | 내용 |
|-----|------|
| 기능 ID | BOARD-004 |
| 설명 | 게시판 정보 수정 |
| 선행조건 | 게시판 생성자 또는 관리자 |
| 입력값 | board_id, description, icon_url, banner_url, allow_nsfw |
| 처리로직 | 1. 권한 확인<br>2. boards UPDATE |
| 결과 | 게시판 수정 완료 |
| 관련 테이블 | boards |

### 2.5 게시판 구독
| 항목 | 내용 |
|-----|------|
| 기능 ID | BOARD-005 |
| 설명 | 게시판 구독 (가입) |
| 선행조건 | 로그인 상태 |
| 입력값 | board_id |
| 처리로직 | 1. 이미 구독 여부 확인<br>2. board_subscriptions INSERT (role = MEMBER) |
| 결과 | 구독 완료 |
| 관련 테이블 | board_subscriptions |

### 2.6 게시판 구독 취소
| 항목 | 내용 |
|-----|------|
| 기능 ID | BOARD-006 |
| 설명 | 게시판 구독 해제 |
| 선행조건 | 로그인 상태, 구독 상태 |
| 입력값 | board_id |
| 처리로직 | 1. board_subscriptions DELETE |
| 결과 | 구독 해제 완료 |
| 관련 테이블 | board_subscriptions |

### 2.7 내 구독 게시판 목록
| 항목 | 내용 |
|-----|------|
| 기능 ID | BOARD-007 |
| 설명 | 내가 구독한 게시판 목록 조회 |
| 선행조건 | 로그인 상태 |
| 입력값 | page, size |
| 처리로직 | 1. board_subscriptions 조회 (user_id 기준) |
| 결과 | 구독 게시판 목록 반환 |
| 관련 테이블 | board_subscriptions, boards |

### 2.8 카테고리 목록 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | BOARD-008 |
| 설명 | 특정 게시판의 카테고리 목록 조회 |
| 선행조건 | 없음 |
| 입력값 | board_id |
| 처리로직 | 1. board_categories 조회 (is_active = Y, sort_order 정렬) |
| 결과 | 카테고리 목록 반환 |
| 관련 테이블 | board_categories |

### 2.9 카테고리 관리 (생성/수정/삭제)
| 항목 | 내용 |
|-----|------|
| 기능 ID | BOARD-009 |
| 설명 | 게시판 카테고리 CRUD |
| 선행조건 | 게시판 관리자 권한 |
| 입력값 | board_id, name, sort_order, is_active |
| 처리로직 | 1. 권한 확인<br>2. board_categories INSERT/UPDATE/DELETE |
| 결과 | 카테고리 관리 완료 |
| 관련 테이블 | board_categories |

---

## 3. 게시글

### 3.1 게시글 목록 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | POST-001 |
| 설명 | 게시판별 게시글 목록 조회 |
| 선행조건 | 없음 |
| 입력값 | board_id, category_id, page, size, sort (latest/popular) |
| 처리로직 | 1. posts 조회 (is_deleted = N)<br>2. 차단 사용자 글 제외<br>3. NSFW 설정에 따른 필터링<br>4. 공지사항 상단 고정 |
| 결과 | 게시글 목록 반환 |
| 관련 테이블 | posts, users, user_blocks, user_settings |

### 3.2 게시글 상세 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | POST-002 |
| 설명 | 게시글 상세 내용 조회 |
| 선행조건 | 없음 |
| 입력값 | post_id |
| 처리로직 | 1. posts 조회<br>2. view_count + 1 UPDATE<br>3. 로그인 시 view_histories UPSERT<br>4. 작성자 정보 JOIN<br>5. 태그 정보 조회<br>6. 좋아요 여부 확인 (로그인 시) |
| 결과 | 게시글 상세 정보 반환 |
| 관련 테이블 | posts, users, post_tags, tags, post_likes, view_histories |

### 3.3 게시글 작성
| 항목 | 내용 |
|-----|------|
| 기능 ID | POST-003 |
| 설명 | 새 게시글 작성 |
| 선행조건 | 로그인 상태 |
| 입력값 | board_id, category_id, title, contents, tags[], is_nsfw, is_spoiler |
| 처리로직 | 1. 게시판 존재 여부 확인<br>2. posts INSERT<br>3. 태그 처리 (tags UPSERT, post_tags INSERT, post_count 증가)<br>4. 첨부파일 연결 (files.related_id UPDATE)<br>5. post_versions INSERT (CREATE)<br>6. 포인트 적립 (point_histories, user_points) |
| 결과 | 게시글 생성 완료 |
| 관련 테이블 | posts, tags, post_tags, files, post_versions, point_histories, user_points |

### 3.4 게시글 수정
| 항목 | 내용 |
|-----|------|
| 기능 ID | POST-004 |
| 설명 | 게시글 내용 수정 |
| 선행조건 | 로그인 상태, 작성자 본인 |
| 입력값 | post_id, title, contents, category_id, tags[], is_nsfw, is_spoiler |
| 처리로직 | 1. 작성자 확인<br>2. post_versions INSERT (수정 전 내용 저장)<br>3. posts UPDATE<br>4. 태그 재처리 (기존 태그 삭제, 새 태그 추가) |
| 결과 | 게시글 수정 완료 |
| 관련 테이블 | posts, post_versions, post_tags, tags |

### 3.5 게시글 삭제
| 항목 | 내용 |
|-----|------|
| 기능 ID | POST-005 |
| 설명 | 게시글 삭제 (Soft Delete) |
| 선행조건 | 로그인 상태, 작성자 본인 또는 관리자 |
| 입력값 | post_id |
| 처리로직 | 1. 권한 확인<br>2. posts.is_deleted = Y UPDATE<br>3. post_versions INSERT (DELETE)<br>4. 태그 post_count 감소 |
| 결과 | 게시글 삭제 완료 |
| 관련 테이블 | posts, post_versions, tags |

### 3.6 게시글 좋아요
| 항목 | 내용 |
|-----|------|
| 기능 ID | POST-006 |
| 설명 | 게시글 좋아요 추가 |
| 선행조건 | 로그인 상태 |
| 입력값 | post_id |
| 처리로직 | 1. 이미 좋아요 여부 확인<br>2. post_likes INSERT<br>3. posts.like_count + 1 UPDATE<br>4. 작성자에게 알림 (notifications INSERT) |
| 결과 | 좋아요 완료 |
| 관련 테이블 | post_likes, posts, notifications |

### 3.7 게시글 좋아요 취소
| 항목 | 내용 |
|-----|------|
| 기능 ID | POST-007 |
| 설명 | 게시글 좋아요 취소 |
| 선행조건 | 로그인 상태, 좋아요 상태 |
| 입력값 | post_id |
| 처리로직 | 1. post_likes DELETE<br>2. posts.like_count - 1 UPDATE |
| 결과 | 좋아요 취소 완료 |
| 관련 테이블 | post_likes, posts |

### 3.8 게시글 스크랩
| 항목 | 내용 |
|-----|------|
| 기능 ID | POST-008 |
| 설명 | 게시글 스크랩 추가 |
| 선행조건 | 로그인 상태 |
| 입력값 | post_id, remark |
| 처리로직 | 1. 이미 스크랩 여부 확인<br>2. scraps INSERT |
| 결과 | 스크랩 완료 |
| 관련 테이블 | scraps |

### 3.9 게시글 스크랩 취소
| 항목 | 내용 |
|-----|------|
| 기능 ID | POST-009 |
| 설명 | 게시글 스크랩 취소 |
| 선행조건 | 로그인 상태, 스크랩 상태 |
| 입력값 | post_id |
| 처리로직 | 1. scraps DELETE |
| 결과 | 스크랩 취소 완료 |
| 관련 테이블 | scraps |

### 3.10 내 스크랩 목록
| 항목 | 내용 |
|-----|------|
| 기능 ID | POST-010 |
| 설명 | 내가 스크랩한 게시글 목록 조회 |
| 선행조건 | 로그인 상태 |
| 입력값 | page, size |
| 처리로직 | 1. scraps 조회 (user_id 기준) |
| 결과 | 스크랩 목록 반환 |
| 관련 테이블 | scraps, posts |

### 3.11 임시저장 목록 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | POST-011 |
| 설명 | 임시저장 게시글 목록 조회 |
| 선행조건 | 로그인 상태 |
| 입력값 | page, size |
| 처리로직 | 1. draft_posts 조회 (user_id 기준) |
| 결과 | 임시저장 목록 반환 |
| 관련 테이블 | draft_posts |

### 3.12 임시저장
| 항목 | 내용 |
|-----|------|
| 기능 ID | POST-012 |
| 설명 | 게시글 임시저장 |
| 선행조건 | 로그인 상태 |
| 입력값 | board_id, title, contents, draft_id (수정 시) |
| 처리로직 | 1. draft_posts INSERT/UPDATE |
| 결과 | 임시저장 완료 |
| 관련 테이블 | draft_posts |

### 3.13 임시저장 삭제
| 항목 | 내용 |
|-----|------|
| 기능 ID | POST-013 |
| 설명 | 임시저장 게시글 삭제 |
| 선행조건 | 로그인 상태, 본인 임시저장 |
| 입력값 | draft_id |
| 처리로직 | 1. draft_posts DELETE |
| 결과 | 임시저장 삭제 완료 |
| 관련 테이블 | draft_posts |

### 3.14 인기글 목록
| 항목 | 내용 |
|-----|------|
| 기능 ID | POST-014 |
| 설명 | 인기글 목록 조회 |
| 선행조건 | 없음 |
| 입력값 | ranking_type (DAILY/WEEKLY/MONTHLY), page, size |
| 처리로직 | 1. popular_posts 조회 (ranking_type, rank 정렬) |
| 결과 | 인기글 목록 반환 |
| 관련 테이블 | popular_posts, posts |

### 3.15 내가 작성한 게시글 목록
| 항목 | 내용 |
|-----|------|
| 기능 ID | POST-015 |
| 설명 | 내가 작성한 게시글 목록 조회 |
| 선행조건 | 로그인 상태 |
| 입력값 | page, size |
| 처리로직 | 1. posts 조회 (user_id 기준, is_deleted = N) |
| 결과 | 내 게시글 목록 반환 |
| 관련 테이블 | posts |

### 3.16 게시글 수정 이력 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | POST-016 |
| 설명 | 게시글 수정 이력 조회 |
| 선행조건 | 없음 |
| 입력값 | post_id |
| 처리로직 | 1. post_versions 조회 (post_id 기준, created_at DESC) |
| 결과 | 수정 이력 목록 반환 |
| 관련 테이블 | post_versions |

---

## 4. 댓글

### 4.1 댓글 목록 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | COMMENT-001 |
| 설명 | 게시글의 댓글 목록 조회 |
| 선행조건 | 없음 |
| 입력값 | post_id, page, size, sort (latest/popular) |
| 처리로직 | 1. comments 조회 (is_deleted = N)<br>2. comment_closures로 계층 구조 구성<br>3. 차단 사용자 댓글 제외<br>4. 삭제된 댓글은 "삭제된 댓글입니다" 표시 (자식이 있는 경우) |
| 결과 | 댓글 목록 반환 (계층 구조) |
| 관련 테이블 | comments, comment_closures, users, user_blocks |

### 4.2 댓글 작성
| 항목 | 내용 |
|-----|------|
| 기능 ID | COMMENT-002 |
| 설명 | 새 댓글 작성 |
| 선행조건 | 로그인 상태 |
| 입력값 | post_id, parent_id (대댓글인 경우), content |
| 처리로직 | 1. 게시글 존재 여부 확인<br>2. parent_id가 있으면 부모 댓글 확인<br>3. comments INSERT (depth 계산)<br>4. comment_closures INSERT (자기 자신 + 조상 관계)<br>5. comment_versions INSERT (CREATE)<br>6. posts.comment_count + 1 UPDATE<br>7. 게시글 작성자에게 알림<br>8. 부모 댓글 작성자에게 알림 (대댓글인 경우)<br>9. 멘션된 사용자에게 알림<br>10. 포인트 적립 |
| 결과 | 댓글 작성 완료 |
| 관련 테이블 | comments, comment_closures, comment_versions, posts, notifications, point_histories, user_points |

### 4.3 댓글 수정
| 항목 | 내용 |
|-----|------|
| 기능 ID | COMMENT-003 |
| 설명 | 댓글 내용 수정 |
| 선행조건 | 로그인 상태, 작성자 본인 |
| 입력값 | comment_id, content |
| 처리로직 | 1. 작성자 확인<br>2. comment_versions INSERT (수정 전 내용 저장)<br>3. comments UPDATE |
| 결과 | 댓글 수정 완료 |
| 관련 테이블 | comments, comment_versions |

### 4.4 댓글 삭제
| 항목 | 내용 |
|-----|------|
| 기능 ID | COMMENT-004 |
| 설명 | 댓글 삭제 (Soft Delete) |
| 선행조건 | 로그인 상태, 작성자 본인 또는 관리자 |
| 입력값 | comment_id |
| 처리로직 | 1. 권한 확인<br>2. comments.is_deleted = Y UPDATE<br>3. comment_versions INSERT (DELETE)<br>4. posts.comment_count - 1 UPDATE |
| 결과 | 댓글 삭제 완료 |
| 관련 테이블 | comments, comment_versions, posts |

### 4.5 댓글 좋아요
| 항목 | 내용 |
|-----|------|
| 기능 ID | COMMENT-005 |
| 설명 | 댓글 좋아요 추가 |
| 선행조건 | 로그인 상태 |
| 입력값 | comment_id |
| 처리로직 | 1. 이미 좋아요 여부 확인<br>2. comment_likes INSERT<br>3. comments.like_count + 1 UPDATE<br>4. 작성자에게 알림 |
| 결과 | 좋아요 완료 |
| 관련 테이블 | comment_likes, comments, notifications |

### 4.6 댓글 좋아요 취소
| 항목 | 내용 |
|-----|------|
| 기능 ID | COMMENT-006 |
| 설명 | 댓글 좋아요 취소 |
| 선행조건 | 로그인 상태, 좋아요 상태 |
| 입력값 | comment_id |
| 처리로직 | 1. comment_likes DELETE<br>2. comments.like_count - 1 UPDATE |
| 결과 | 좋아요 취소 완료 |
| 관련 테이블 | comment_likes, comments |

### 4.7 내가 작성한 댓글 목록
| 항목 | 내용 |
|-----|------|
| 기능 ID | COMMENT-007 |
| 설명 | 내가 작성한 댓글 목록 조회 |
| 선행조건 | 로그인 상태 |
| 입력값 | page, size |
| 처리로직 | 1. comments 조회 (user_id 기준, is_deleted = N) |
| 결과 | 내 댓글 목록 반환 |
| 관련 테이블 | comments, posts |

### 4.8 대댓글 조회 (더보기)
| 항목 | 내용 |
|-----|------|
| 기능 ID | COMMENT-008 |
| 설명 | 특정 댓글의 대댓글 더보기 |
| 선행조건 | 없음 |
| 입력값 | comment_id, page, size |
| 처리로직 | 1. comment_closures로 자식 댓글 조회 (depth = 1) |
| 결과 | 대댓글 목록 반환 |
| 관련 테이블 | comments, comment_closures |

---

## 5. 상호작용

### 5.1 알림 목록 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | NOTI-001 |
| 설명 | 내 알림 목록 조회 |
| 선행조건 | 로그인 상태 |
| 입력값 | page, size, is_read (필터) |
| 처리로직 | 1. notifications 조회 (user_id 기준, created_at DESC) |
| 결과 | 알림 목록 반환 |
| 관련 테이블 | notifications, users |

### 5.2 알림 읽음 처리
| 항목 | 내용 |
|-----|------|
| 기능 ID | NOTI-002 |
| 설명 | 알림 읽음 처리 |
| 선행조건 | 로그인 상태 |
| 입력값 | notification_id |
| 처리로직 | 1. notifications.is_read = Y UPDATE |
| 결과 | 읽음 처리 완료 |
| 관련 테이블 | notifications |

### 5.3 알림 전체 읽음 처리
| 항목 | 내용 |
|-----|------|
| 기능 ID | NOTI-003 |
| 설명 | 모든 알림 읽음 처리 |
| 선행조건 | 로그인 상태 |
| 입력값 | 없음 |
| 처리로직 | 1. notifications 전체 is_read = Y UPDATE (user_id 기준) |
| 결과 | 전체 읽음 처리 완료 |
| 관련 테이블 | notifications |

### 5.4 읽지 않은 알림 수 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | NOTI-004 |
| 설명 | 읽지 않은 알림 개수 조회 |
| 선행조건 | 로그인 상태 |
| 입력값 | 없음 |
| 처리로직 | 1. notifications COUNT (is_read = N) |
| 결과 | 읽지 않은 알림 수 반환 |
| 관련 테이블 | notifications |

### 5.5 쪽지 발송
| 항목 | 내용 |
|-----|------|
| 기능 ID | MSG-001 |
| 설명 | 쪽지 발송 |
| 선행조건 | 로그인 상태 |
| 입력값 | receiver_id, content |
| 처리로직 | 1. 수신자 존재 여부 확인<br>2. 차단 여부 확인 (상대방이 나를 차단했는지)<br>3. messages INSERT<br>4. 수신자에게 알림 |
| 결과 | 쪽지 발송 완료 |
| 관련 테이블 | messages, user_blocks, notifications |

### 5.6 받은 쪽지 목록
| 항목 | 내용 |
|-----|------|
| 기능 ID | MSG-002 |
| 설명 | 받은 쪽지 목록 조회 |
| 선행조건 | 로그인 상태 |
| 입력값 | page, size |
| 처리로직 | 1. messages 조회 (receiver_id 기준, is_deleted_by_receiver = N) |
| 결과 | 받은 쪽지 목록 반환 |
| 관련 테이블 | messages, users |

### 5.7 보낸 쪽지 목록
| 항목 | 내용 |
|-----|------|
| 기능 ID | MSG-003 |
| 설명 | 보낸 쪽지 목록 조회 |
| 선행조건 | 로그인 상태 |
| 입력값 | page, size |
| 처리로직 | 1. messages 조회 (sender_id 기준, is_deleted_by_sender = N) |
| 결과 | 보낸 쪽지 목록 반환 |
| 관련 테이블 | messages, users |

### 5.8 쪽지 상세 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | MSG-004 |
| 설명 | 쪽지 상세 내용 조회 |
| 선행조건 | 로그인 상태, 발신자 또는 수신자 |
| 입력값 | message_id |
| 처리로직 | 1. messages 조회<br>2. 수신자인 경우 is_read = Y UPDATE |
| 결과 | 쪽지 상세 정보 반환 |
| 관련 테이블 | messages |

### 5.9 쪽지 삭제
| 항목 | 내용 |
|-----|------|
| 기능 ID | MSG-005 |
| 설명 | 쪽지 삭제 (본인 입장에서만) |
| 선행조건 | 로그인 상태, 발신자 또는 수신자 |
| 입력값 | message_id |
| 처리로직 | 1. 발신자면 is_deleted_by_sender = Y<br>2. 수신자면 is_deleted_by_receiver = Y<br>3. 양쪽 다 삭제면 Hard Delete (선택) |
| 결과 | 쪽지 삭제 완료 |
| 관련 테이블 | messages |

### 5.10 읽지 않은 쪽지 수 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | MSG-006 |
| 설명 | 읽지 않은 쪽지 개수 조회 |
| 선행조건 | 로그인 상태 |
| 입력값 | 없음 |
| 처리로직 | 1. messages COUNT (receiver_id, is_read = N, is_deleted_by_receiver = N) |
| 결과 | 읽지 않은 쪽지 수 반환 |
| 관련 테이블 | messages |

---

## 6. 검색

### 6.1 통합 검색
| 항목 | 내용 |
|-----|------|
| 기능 ID | SEARCH-001 |
| 설명 | 게시글/댓글/사용자 통합 검색 |
| 선행조건 | 없음 |
| 입력값 | keyword, type (all/post/comment/user), page, size |
| 처리로직 | 1. Elasticsearch 검색<br>2. search_statistics UPSERT (keyword + 오늘 날짜)<br>3. 로그인 시 search_personalization INSERT |
| 결과 | 검색 결과 반환 |
| 관련 테이블 | search_statistics, search_personalization |

### 6.2 게시글 검색
| 항목 | 내용 |
|-----|------|
| 기능 ID | SEARCH-002 |
| 설명 | 게시글 검색 (제목/내용) |
| 선행조건 | 없음 |
| 입력값 | keyword, board_id (선택), page, size |
| 처리로직 | 1. Elasticsearch 검색 (posts)<br>2. 삭제된 글 제외<br>3. 차단 사용자 글 제외 |
| 결과 | 게시글 검색 결과 반환 |
| 관련 테이블 | posts |

### 6.3 인기 검색어 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | SEARCH-003 |
| 설명 | 인기 검색어 목록 조회 |
| 선행조건 | 없음 |
| 입력값 | period (daily/weekly), limit |
| 처리로직 | 1. search_statistics 집계 (기간별 search_count 합계) |
| 결과 | 인기 검색어 목록 반환 |
| 관련 테이블 | search_statistics |

### 6.4 최근 검색어 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | SEARCH-004 |
| 설명 | 내 최근 검색어 목록 조회 |
| 선행조건 | 로그인 상태 |
| 입력값 | limit |
| 처리로직 | 1. search_personalization 조회 (user_id 기준, created_at DESC) |
| 결과 | 최근 검색어 목록 반환 |
| 관련 테이블 | search_personalization |

### 6.5 최근 검색어 삭제
| 항목 | 내용 |
|-----|------|
| 기능 ID | SEARCH-005 |
| 설명 | 최근 검색어 삭제 |
| 선행조건 | 로그인 상태 |
| 입력값 | log_id 또는 전체 삭제 |
| 처리로직 | 1. search_personalization DELETE |
| 결과 | 검색어 삭제 완료 |
| 관련 테이블 | search_personalization |

---

## 7. 포인트/상점

### 7.1 내 포인트 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | POINT-001 |
| 설명 | 현재 보유 포인트 조회 |
| 선행조건 | 로그인 상태 |
| 입력값 | 없음 |
| 처리로직 | 1. user_points 조회 |
| 결과 | 현재 포인트 반환 |
| 관련 테이블 | user_points |

### 7.2 포인트 이력 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | POINT-002 |
| 설명 | 포인트 적립/사용 이력 조회 |
| 선행조건 | 로그인 상태 |
| 입력값 | type (전체/EARN/SPEND), page, size |
| 처리로직 | 1. point_histories 조회 (user_id 기준, created_at DESC) |
| 결과 | 포인트 이력 목록 반환 |
| 관련 테이블 | point_histories |

### 7.3 상점 아이템 목록
| 항목 | 내용 |
|-----|------|
| 기능 ID | SHOP-001 |
| 설명 | 상점 아이템 목록 조회 |
| 선행조건 | 없음 |
| 입력값 | item_type (필터), page, size |
| 처리로직 | 1. shop_items 조회 (is_active = Y) |
| 결과 | 아이템 목록 반환 |
| 관련 테이블 | shop_items |

### 7.4 아이템 구매
| 항목 | 내용 |
|-----|------|
| 기능 ID | SHOP-002 |
| 설명 | 포인트로 아이템 구매 |
| 선행조건 | 로그인 상태, 충분한 포인트 |
| 입력값 | item_id |
| 처리로직 | 1. shop_items 조회 (가격 확인)<br>2. user_points 잔액 확인<br>3. user_points.current_point 차감<br>4. point_histories INSERT (SPEND, balance_after, description)<br>5. purchase_history INSERT<br>6. 아이템 효과 적용 (별도 처리) |
| 결과 | 구매 완료 |
| 관련 테이블 | shop_items, user_points, point_histories, purchase_history |

### 7.5 구매 이력 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | SHOP-003 |
| 설명 | 아이템 구매 이력 조회 |
| 선행조건 | 로그인 상태 |
| 입력값 | page, size |
| 처리로직 | 1. purchase_history 조회 (user_id 기준, created_at DESC) |
| 결과 | 구매 이력 목록 반환 |
| 관련 테이블 | purchase_history, shop_items |

---

## 8. 관리자

### 8.1 신고 목록 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | ADMIN-001 |
| 설명 | 신고 목록 조회 |
| 선행조건 | 관리자 권한 |
| 입력값 | status (PENDING/RESOLVED/REJECTED), target_type, page, size |
| 처리로직 | 1. 권한 확인 (admins)<br>2. reports 조회 |
| 결과 | 신고 목록 반환 |
| 관련 테이블 | reports, admins |

### 8.2 신고 처리
| 항목 | 내용 |
|-----|------|
| 기능 ID | ADMIN-002 |
| 설명 | 신고 처리 (승인/반려) |
| 선행조건 | 관리자 권한 |
| 입력값 | report_id, status (RESOLVED/REJECTED), remark |
| 처리로직 | 1. 권한 확인<br>2. reports UPDATE (status, admin_id)<br>3. 승인 시 해당 콘텐츠 처리 (삭제 등)<br>4. 승인 시 작성자 제재 (선택) |
| 결과 | 신고 처리 완료 |
| 관련 테이블 | reports, posts, comments, sanctions |

### 8.3 사용자 제재
| 항목 | 내용 |
|-----|------|
| 기능 ID | ADMIN-003 |
| 설명 | 사용자 제재 (경고/정지/차단) |
| 선행조건 | 관리자 권한 |
| 입력값 | target_user_id, type (WARNING/MUTE/BAN), end_date, remark |
| 처리로직 | 1. 권한 확인<br>2. sanctions INSERT<br>3. BAN인 경우 users.status = SUSPENDED UPDATE<br>4. 모든 refresh_tokens 폐기 |
| 결과 | 제재 완료 |
| 관련 테이블 | sanctions, users, refresh_tokens, admins |

### 8.4 제재 이력 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | ADMIN-004 |
| 설명 | 사용자별 제재 이력 조회 |
| 선행조건 | 관리자 권한 |
| 입력값 | user_id, page, size |
| 처리로직 | 1. 권한 확인<br>2. sanctions 조회 (target_user_id 기준) |
| 결과 | 제재 이력 목록 반환 |
| 관련 테이블 | sanctions |

### 8.5 IP 차단
| 항목 | 내용 |
|-----|------|
| 기능 ID | ADMIN-005 |
| 설명 | IP 차단 등록 |
| 선행조건 | 관리자 권한 |
| 입력값 | ip_address, reason, end_date |
| 처리로직 | 1. 권한 확인<br>2. ip_blocks INSERT |
| 결과 | IP 차단 완료 |
| 관련 테이블 | ip_blocks, admins |

### 8.6 IP 차단 해제
| 항목 | 내용 |
|-----|------|
| 기능 ID | ADMIN-006 |
| 설명 | IP 차단 해제 |
| 선행조건 | 관리자 권한 |
| 입력값 | ip_address |
| 처리로직 | 1. 권한 확인<br>2. ip_blocks DELETE |
| 결과 | IP 차단 해제 완료 |
| 관련 테이블 | ip_blocks |

### 8.7 게시글 관리 (삭제/복구)
| 항목 | 내용 |
|-----|------|
| 기능 ID | ADMIN-007 |
| 설명 | 게시글 삭제 또는 복구 |
| 선행조건 | 관리자 권한 |
| 입력값 | post_id, action (delete/restore) |
| 처리로직 | 1. 권한 확인<br>2. posts.is_deleted UPDATE<br>3. logs INSERT |
| 결과 | 게시글 관리 완료 |
| 관련 테이블 | posts, logs, admins |

### 8.8 댓글 관리 (삭제/복구)
| 항목 | 내용 |
|-----|------|
| 기능 ID | ADMIN-008 |
| 설명 | 댓글 삭제 또는 복구 |
| 선행조건 | 관리자 권한 |
| 입력값 | comment_id, action (delete/restore) |
| 처리로직 | 1. 권한 확인<br>2. comments.is_deleted UPDATE<br>3. logs INSERT |
| 결과 | 댓글 관리 완료 |
| 관련 테이블 | comments, logs, admins |

### 8.9 사용자 관리
| 항목 | 내용 |
|-----|------|
| 기능 ID | ADMIN-009 |
| 설명 | 사용자 상태 변경 |
| 선행조건 | 관리자 권한 |
| 입력값 | user_id, status (ACTIVE/SUSPENDED/DELETED) |
| 처리로직 | 1. 권한 확인<br>2. users.status UPDATE<br>3. logs INSERT |
| 결과 | 사용자 상태 변경 완료 |
| 관련 테이블 | users, logs, admins |

### 8.10 게시판 관리
| 항목 | 내용 |
|-----|------|
| 기능 ID | ADMIN-010 |
| 설명 | 게시판 활성화/비활성화/정렬순서 변경 |
| 선행조건 | 관리자 권한 |
| 입력값 | board_id, is_active, sort_order |
| 처리로직 | 1. 권한 확인<br>2. boards UPDATE<br>3. logs INSERT |
| 결과 | 게시판 관리 완료 |
| 관련 테이블 | boards, logs, admins |

### 8.11 활동 로그 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | ADMIN-011 |
| 설명 | 시스템 활동 로그 조회 |
| 선행조건 | 관리자 권한 |
| 입력값 | user_id, action_type, date_from, date_to, page, size |
| 처리로직 | 1. 권한 확인<br>2. logs 조회 |
| 결과 | 활동 로그 목록 반환 |
| 관련 테이블 | logs |

### 8.12 전역 설정 관리
| 항목 | 내용 |
|-----|------|
| 기능 ID | ADMIN-012 |
| 설명 | 전역 설정 조회/수정 |
| 선행조건 | 슈퍼 관리자 권한 |
| 입력값 | config_key, config_value |
| 처리로직 | 1. 권한 확인 (SUPER)<br>2. global_configs 조회/UPSERT |
| 결과 | 설정 조회/수정 완료 |
| 관련 테이블 | global_configs, admins |

### 8.13 관리자 권한 관리
| 항목 | 내용 |
|-----|------|
| 기능 ID | ADMIN-013 |
| 설명 | 관리자 추가/수정/삭제 |
| 선행조건 | 슈퍼 관리자 권한 |
| 입력값 | user_id, board_id, role, is_active |
| 처리로직 | 1. 권한 확인 (SUPER)<br>2. admins INSERT/UPDATE/DELETE |
| 결과 | 관리자 권한 관리 완료 |
| 관련 테이블 | admins |

---

## 9. 기타

### 9.1 신고하기
| 항목 | 내용 |
|-----|------|
| 기능 ID | ETC-001 |
| 설명 | 게시글/댓글/사용자 신고 |
| 선행조건 | 로그인 상태 |
| 입력값 | target_type (POST/COMMENT/USER), target_id, reason_type, contents |
| 처리로직 | 1. 이미 신고 여부 확인 (중복 방지)<br>2. reports INSERT (status = PENDING) |
| 결과 | 신고 접수 완료 |
| 관련 테이블 | reports |

### 9.2 파일 업로드
| 항목 | 내용 |
|-----|------|
| 기능 ID | ETC-002 |
| 설명 | 파일 업로드 (이미지/첨부파일) |
| 선행조건 | 로그인 상태 |
| 입력값 | file (multipart) |
| 처리로직 | 1. 파일 유효성 검사 (크기, 확장자)<br>2. 스토리지 저장<br>3. files INSERT (related_id = NULL, 임시 상태) |
| 결과 | 파일 URL 반환 |
| 관련 테이블 | files |

### 9.3 공통코드 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | ETC-003 |
| 설명 | 공통코드 목록 조회 |
| 선행조건 | 없음 |
| 입력값 | type_code |
| 처리로직 | 1. common_code_details 조회 (is_active = Y, sort_order 정렬) |
| 결과 | 공통코드 목록 반환 |
| 관련 테이블 | common_codes, common_code_details |

### 9.4 광고 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | ETC-004 |
| 설명 | 광고 배너 조회 |
| 선행조건 | 없음 |
| 입력값 | placement |
| 처리로직 | 1. ads 조회 (is_active = Y, 기간 내)<br>2. ads.impression_count + 1 UPDATE |
| 결과 | 광고 정보 반환 |
| 관련 테이블 | ads |

### 9.5 광고 클릭 기록
| 항목 | 내용 |
|-----|------|
| 기능 ID | ETC-005 |
| 설명 | 광고 클릭 기록 |
| 선행조건 | 없음 |
| 입력값 | ad_id |
| 처리로직 | 1. ad_click_logs INSERT<br>2. ads.click_count + 1 UPDATE |
| 결과 | 클릭 기록 완료, target_url 반환 |
| 관련 테이블 | ads, ad_click_logs |

### 9.6 열람 기록 조회
| 항목 | 내용 |
|-----|------|
| 기능 ID | ETC-006 |
| 설명 | 내 열람 기록 조회 |
| 선행조건 | 로그인 상태 |
| 입력값 | page, size |
| 처리로직 | 1. view_histories 조회 (user_id 기준, modified_at DESC) |
| 결과 | 열람 기록 목록 반환 |
| 관련 테이블 | view_histories, posts |

### 9.7 열람 기록 삭제
| 항목 | 내용 |
|-----|------|
| 기능 ID | ETC-007 |
| 설명 | 열람 기록 삭제 |
| 선행조건 | 로그인 상태 |
| 입력값 | view_history_id 또는 전체 삭제 |
| 처리로직 | 1. view_histories DELETE |
| 결과 | 열람 기록 삭제 완료 |
| 관련 테이블 | view_histories |

---

## 배치 작업

### BATCH-001: 인기글 집계
| 항목 | 내용 |
|-----|------|
| 설명 | 인기글 순위 계산 및 캐시 갱신 |
| 주기 | 1시간마다 |
| 처리로직 | 1. 기간별 (일간/주간/월간) 점수 계산<br>2. popular_posts 전체 삭제 후 INSERT |
| 관련 테이블 | posts, popular_posts |

### BATCH-002: 임시파일 정리
| 항목 | 내용 |
|-----|------|
| 설명 | 미연결 임시 파일 삭제 |
| 주기 | 매일 새벽 |
| 처리로직 | 1. files 조회 (related_id IS NULL, created_at < 24시간 전)<br>2. 스토리지 파일 삭제<br>3. files DELETE |
| 관련 테이블 | files |

### BATCH-003: 만료 토큰 정리
| 항목 | 내용 |
|-----|------|
| 설명 | 만료된 Refresh Token 삭제 |
| 주기 | 매일 새벽 |
| 처리로직 | 1. refresh_tokens DELETE (expires_at < NOW()) |
| 관련 테이블 | refresh_tokens |

### BATCH-004: 탈퇴 회원 정리
| 항목 | 내용 |
|-----|------|
| 설명 | 탈퇴 후 보존 기간 지난 회원 데이터 정리 |
| 주기 | 매일 새벽 |
| 처리로직 | 1. users 조회 (status = DELETED, deleted_at < 보존기간)<br>2. 개인정보 완전 삭제/익명화 |
| 관련 테이블 | users |

### BATCH-005: 비정규화 카운터 동기화
| 항목 | 내용 |
|-----|------|
| 설명 | 비정규화 카운터 실제 값과 동기화 |
| 주기 | 매일 새벽 |
| 처리로직 | 1. posts.like_count, comment_count, view_count 재계산<br>2. comments.like_count 재계산<br>3. tags.post_count 재계산 |
| 관련 테이블 | posts, comments, tags |

### BATCH-006: 메시지 큐 처리
| 항목 | 내용 |
|-----|------|
| 설명 | 발송 대기 메시지 처리 |
| 주기 | 1분마다 |
| 처리로직 | 1. message_queue 조회 (status = PENDING)<br>2. 발송 처리 (EMAIL/PUSH/SMS)<br>3. status UPDATE (SENT/FAILED)<br>4. 실패 시 retry_count + 1 |
| 관련 테이블 | message_queue |

---

## 기능 요약

| 영역 | 기능 수 |
|-----|--------|
| 회원 | 16개 |
| 게시판 | 9개 |
| 게시글 | 16개 |
| 댓글 | 8개 |
| 상호작용 | 10개 |
| 검색 | 5개 |
| 포인트/상점 | 5개 |
| 관리자 | 13개 |
| 기타 | 7개 |
| 배치 | 6개 |
| **총계** | **95개** |